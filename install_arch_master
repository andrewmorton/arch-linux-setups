#!/bin/bash

# Finish Arch setups, run after first pacstrap in new env
ln -sf /usr/share/zoneinfo/America/New_York /etc/localtime

# Sync time
hwclock --systohc

# Set Locale
echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
echo "LANG=en_US.UTF-8" >> /etc/locale.conf
echo "Generating locales"
locale-gen
echo "locale-gen was run"

echo "Setting Caps to CTRL"
localectl set-x11-keymap "" "" "" ctrl:nocaps

# Set Java window drawing for Jetbrains IDE
echo """
# Fixing Java app window draw for JetBrains IDEs
export _JAVA_AWT_WM_NONREPARENTING=1
""" >> /etc/environment


##### Configure network
# Collect user information regarding their chosen hostname
# and cat to appropriate files
#####

read -p "Enter your super sweet hostname: " HOSTNAME
export HOSTNAME=$HOSTNAME

echo "$HOSTNAME" >> /etc/hostname

# Configure hosts file
cat << "EOF" > /etc/hosts
# Enter Your hostname information here
# This was generated by arch-linux-setups install_arch_master script
127.0.0.1	localhost
::1		localhost
127.0.0.1	${HOSTNAME}.localdomain	${HOSTNAME}
EOF

# TODO: Configure NetworkManager to login to wireless access point

##### END Configure network

# run multilib setup
echo "Running mutlilib_on.sh"
./user_scripts/multilib_on.sh &&
	echo "Successful"

# Install paclist_system from install paclist dir in repo
echo "Running install_paclist on paclist_system.txt"
./pacman_install/install_paclist ./pacman_install/paclist_system.txt &&
	echo "Successful"

# install paclist.txt
echo "Running install_paclist on paclist.txt"
./pacman_install/install_paclist ./pacman_install/paclist.txt &&
	echo "Successful"

# Setup autorandr "no_connections" as default profile
echo "Setting auotrandr no_connections profile"
autorandr -s no_connections

# Enable sddm and NetworkManger
systemctl enable sddm
systemctl enable NetworkManager

##### User management
# Create sudo group
groupadd sudo
# useradd
read -p "Enter the name of your RAD user: " USERNAME
useradd -m -G sudo,users $USERNAME

# reboot
